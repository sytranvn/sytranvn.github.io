<!doctype html><html lang=en><head><title>Debug V8 part 2 · sytranvn.dev
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Sy Tran"><meta name=description content="In previous part, we have learnt how to debug d8 with lldb. In this part
we still use our debug.js script. But we&rsquo;ll add an other parameter to d8
before running process.
lldb -- d8 --parse-only debug.js
With parse-only flag, we will forcus on how d8 parse source content and
turn into lexical input elements.
Let&rsquo;s add a breakpoint in v8::Shell::RunMain function and jump to it.
(lldb) b v8::Shell::RunMain
(lldb) run
frame #0: 0x000000010004ba68 d8`v8::Shell::RunMain(isolate=0x0000000118110000, last_run=true) at d8.cc:4578:12
   4575	}
   4576
   4577	int Shell::RunMain(Isolate* isolate, bool last_run) {
-> 4578	  for (int i = 1; i < options.num_isolates; ++i) {
   4579	    options.isolate_sources[i].StartExecuteInThread();
   4580	  }
   4581	  bool success = true;
At line 4578, we will loop through different isolate sources and execute them
in threads. But as our options.num_isolates = 1, we don&rsquo;t need to worry about
multi-threads at this point."><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Debug V8 part 2"><meta name=twitter:description content="In previous part, we have learnt how to debug d8 with lldb. In this part we still use our debug.js script. But we’ll add an other parameter to d8 before running process.
lldb -- d8 --parse-only debug.js With parse-only flag, we will forcus on how d8 parse source content and turn into lexical input elements.
Let’s add a breakpoint in v8::Shell::RunMain function and jump to it.
(lldb) b v8::Shell::RunMain (lldb) run frame #0: 0x000000010004ba68 d8`v8::Shell::RunMain(isolate=0x0000000118110000, last_run=true) at d8.cc:4578:12 4575	} 4576 4577	int Shell::RunMain(Isolate* isolate, bool last_run) { -> 4578	for (int i = 1; i < options.num_isolates; ++i) { 4579	options.isolate_sources[i].StartExecuteInThread(); 4580	} 4581	bool success = true; At line 4578, we will loop through different isolate sources and execute them in threads. But as our options.num_isolates = 1, we don’t need to worry about multi-threads at this point."><meta property="og:url" content="http://sytranvn.dev/posts/debug-v8-part-2/"><meta property="og:site_name" content="sytranvn.dev"><meta property="og:title" content="Debug V8 part 2"><meta property="og:description" content="In previous part, we have learnt how to debug d8 with lldb. In this part we still use our debug.js script. But we’ll add an other parameter to d8 before running process.
lldb -- d8 --parse-only debug.js With parse-only flag, we will forcus on how d8 parse source content and turn into lexical input elements.
Let’s add a breakpoint in v8::Shell::RunMain function and jump to it.
(lldb) b v8::Shell::RunMain (lldb) run frame #0: 0x000000010004ba68 d8`v8::Shell::RunMain(isolate=0x0000000118110000, last_run=true) at d8.cc:4578:12 4575	} 4576 4577	int Shell::RunMain(Isolate* isolate, bool last_run) { -> 4578	for (int i = 1; i < options.num_isolates; ++i) { 4579	options.isolate_sources[i].StartExecuteInThread(); 4580	} 4581	bool success = true; At line 4578, we will loop through different isolate sources and execute them in threads. But as our options.num_isolates = 1, we don’t need to worry about multi-threads at this point."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-02-10T00:00:00+00:00"><meta property="article:modified_time" content="2022-02-10T00:00:00+00:00"><meta property="og:see_also" content="http://sytranvn.dev/posts/debug-v8-part-1/"><meta property="og:see_also" content="http://sytranvn.dev/posts/token/"><meta property="og:see_also" content="http://sytranvn.dev/posts/build-v8-from-source-on-apple-m1/"><meta property="og:see_also" content="http://sytranvn.dev/posts/build-v8-from-source/"><meta property="og:see_also" content="http://sytranvn.dev/posts/v8-adventure/"><link rel=canonical href=http://sytranvn.dev/posts/debug-v8-part-2/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.b886fe0d9034709648f91f4ce178f51dd367d9350f82dd1132d54fd69bfca66f.css integrity="sha256-uIb+DZA0cJZI+R9M4Xj1HdNn2TUPgt0RMtVP1pv8pm8=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/custom.min.e01fd2443128634dc9cf70bef26c23d851bd25b3bb24cf183925fcc0e318f691.css integrity="sha256-4B/SRDEoY03Jz3C+8mwj2FG9JbO7JM8YOSX8wOMY9pE=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-dark"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=http://sytranvn.dev/>sytranvn.dev
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/now/>Now</a></li><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=/i-heart-oss/>I ❤️ OSS</a></li><li class=navigation-item><a class=navigation-link href=/accomplishments/>Accomplishments</a></li><li class=navigation-item><a class=navigation-link href=/resume.pdf>Resume</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=http://sytranvn.dev/posts/debug-v8-part-2/>Debug V8 part 2</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2022-02-10T00:00:00Z>February 10, 2022
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
7-minute read</span></div><div class=categories><i class="fa-solid fa-folder" aria-hidden=true></i>
<a href=/categories/v8/>V8</a>
<span class=separator>•</span>
<a href=/categories/lldb/>Lldb</a></div></div></header><div class=post-content><p>In previous part, we have learnt how to debug <code>d8</code> with <code>lldb</code>. In this part
we still use our <code>debug.js</code> script. But we&rsquo;ll add an other parameter to <code>d8</code>
before running process.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>lldb -- d8 --parse-only debug.js
</span></span></code></pre></div><p>With <code>parse-only</code> flag, we will forcus on how <code>d8</code> parse source content and
turn into lexical input elements.</p><p>Let&rsquo;s add a breakpoint in <code>v8::Shell::RunMain</code> function and jump to it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>(</span>lldb<span style=color:#f92672>)</span> b v8::Shell::RunMain
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>lldb<span style=color:#f92672>)</span> run
</span></span><span style=display:flex><span>frame <span style=color:#75715e>#0: 0x000000010004ba68 d8`v8::Shell::RunMain(isolate=0x0000000118110000, last_run=true) at d8.cc:4578:12</span>
</span></span><span style=display:flex><span>   4575	<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>4576</span>
</span></span><span style=display:flex><span>   4577	int Shell::RunMain<span style=color:#f92672>(</span>Isolate* isolate, bool last_run<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex;background-color:#3c3d38><span>-&gt; 4578	  <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>int i <span style=color:#f92672>=</span> 1; i &lt; options.num_isolates; ++i<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>   4579	    options.isolate_sources<span style=color:#f92672>[</span>i<span style=color:#f92672>]</span>.StartExecuteInThread<span style=color:#f92672>()</span>;
</span></span><span style=display:flex><span>   4580	  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>   4581	  bool success <span style=color:#f92672>=</span> true;
</span></span></code></pre></div><p>At line 4578, we will loop through different isolate sources and execute them
in threads. But as our <code>options.num_isolates = 1</code>, we don&rsquo;t need to worry about
multi-threads at this point.</p><div class=highlight title=src/d8.cc><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4595
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4596
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4597
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4598
</span><span style=background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4599
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4600
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4601
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-cpp data-lang=cpp><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      Context<span style=color:#f92672>::</span>Scope cscope(context);
</span></span><span style=display:flex><span>      InspectorClient <span style=color:#a6e22e>inspector_client</span>(context, options.enable_inspector);
</span></span><span style=display:flex><span>      PerIsolateData<span style=color:#f92672>::</span>RealmScope realm_scope(PerIsolateData<span style=color:#f92672>::</span>Get(isolate));
</span></span><span style=display:flex;background-color:#3c3d38><span>      <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>options.isolate_sources[<span style=color:#ae81ff>0</span>].Execute(isolate)) success <span style=color:#f92672>=</span> false;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>CompleteMessageLoop(isolate)) success <span style=color:#f92672>=</span> false;
</span></span><span style=display:flex><span>    }
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s jump into <code>Execute(isolate)</code> function.</p><div class=highlight title=src/d8.cc><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3927
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3928
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3929
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3930
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3931
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3932
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3933
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3934
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3935
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3936
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3937
</span><span style=background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3938
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3939
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3940
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3941
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3942
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3943
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-cpp data-lang=cpp><span style=display:flex><span>    <span style=color:#75715e>// Use all other arguments as names of files to load and run.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    HandleScope <span style=color:#a6e22e>handle_scope</span>(isolate);
</span></span><span style=display:flex><span>    Local<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> file_name <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>        String<span style=color:#f92672>::</span>NewFromUtf8(isolate, arg).ToLocalChecked();
</span></span><span style=display:flex><span>    Local<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> source <span style=color:#f92672>=</span> Shell<span style=color:#f92672>::</span>ReadFile(isolate, arg);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (source.IsEmpty()) {
</span></span><span style=display:flex><span>      printf(<span style=color:#e6db74>&#34;Error reading &#39;%s&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, arg);
</span></span><span style=display:flex><span>      base<span style=color:#f92672>::</span>OS<span style=color:#f92672>::</span>ExitProcess(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    Shell<span style=color:#f92672>::</span>set_script_executed();
</span></span><span style=display:flex><span>    Shell<span style=color:#f92672>::</span>update_script_size(source<span style=color:#f92672>-&gt;</span>Length());
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>Shell<span style=color:#f92672>::</span>ExecuteString(isolate, source, file_name, Shell<span style=color:#f92672>::</span>kNoPrintResult,
</span></span><span style=display:flex><span>                              Shell<span style=color:#f92672>::</span>kReportExceptions,
</span></span><span style=display:flex><span>                              Shell<span style=color:#f92672>::</span>kProcessMessageQueue)) {
</span></span><span style=display:flex><span>      success <span style=color:#f92672>=</span> false;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>    }
</span></span></code></pre></td></tr></table></div></div><p>Ource <code>debug.js</code> will be read into <code>Local&lt;String> source</code> variable. So let take
a look at <code>v8::Shell::ReadFile</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>b v8::Shell::ReadFile
</span></span><span style=display:flex><span>c
</span></span></code></pre></div><div class=highlight title=src/d8.cc><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3620
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3621
</span><span style=background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3622
</span></span><span style=background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3623
</span></span><span style=background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3624
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3625
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3626
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3627
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3628
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3629
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3630
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3631
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3632
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3633
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3634
</span><span style=background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3635
</span></span><span style=background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3636
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3637
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3638
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3639
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3640
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3641
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3642
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3643
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3644
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3645
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3646
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3647
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-cpp data-lang=cpp><span style=display:flex><span>Local<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> Shell<span style=color:#f92672>::</span>ReadFile(Isolate<span style=color:#f92672>*</span> isolate, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> name,
</span></span><span style=display:flex><span>                              <span style=color:#66d9ef>bool</span> should_throw) {
</span></span><span style=display:flex;background-color:#3c3d38><span>  std<span style=color:#f92672>::</span>unique_ptr<span style=color:#f92672>&lt;</span>base<span style=color:#f92672>::</span>OS<span style=color:#f92672>::</span>MemoryMappedFile<span style=color:#f92672>&gt;</span> file(
</span></span><span style=display:flex;background-color:#3c3d38><span>      base<span style=color:#f92672>::</span>OS<span style=color:#f92672>::</span>MemoryMappedFile<span style=color:#f92672>::</span>open(
</span></span><span style=display:flex;background-color:#3c3d38><span>          name, base<span style=color:#f92672>::</span>OS<span style=color:#f92672>::</span>MemoryMappedFile<span style=color:#f92672>::</span>FileMode<span style=color:#f92672>::</span>kReadOnly));
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>file) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (should_throw) {
</span></span><span style=display:flex><span>      std<span style=color:#f92672>::</span>ostringstream oss;
</span></span><span style=display:flex><span>      oss <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#34;Error loading file: </span><span style=color:#ae81ff>\&#34;</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>&lt;&lt;</span> name <span style=color:#f92672>&lt;&lt;</span> <span style=color:#e6db74>&#39;&#34;&#39;</span>;
</span></span><span style=display:flex><span>      isolate<span style=color:#f92672>-&gt;</span>ThrowError(
</span></span><span style=display:flex><span>          v8<span style=color:#f92672>::</span>String<span style=color:#f92672>::</span>NewFromUtf8(isolate, oss.str().c_str()).ToLocalChecked());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> Local<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span>();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#66d9ef>int</span> size <span style=color:#f92672>=</span> <span style=color:#66d9ef>static_cast</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>int</span><span style=color:#f92672>&gt;</span>(file<span style=color:#f92672>-&gt;</span>size());
</span></span><span style=display:flex;background-color:#3c3d38><span>  <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> chars <span style=color:#f92672>=</span> <span style=color:#66d9ef>static_cast</span><span style=color:#f92672>&lt;</span><span style=color:#66d9ef>char</span><span style=color:#f92672>*&gt;</span>(file<span style=color:#f92672>-&gt;</span>memory());
</span></span><span style=display:flex><span>  Local<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> result;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (i<span style=color:#f92672>::</span>FLAG_use_external_strings <span style=color:#f92672>&amp;&amp;</span> i<span style=color:#f92672>::</span>String<span style=color:#f92672>::</span>IsAscii(chars, size)) {
</span></span><span style=display:flex><span>    String<span style=color:#f92672>::</span>ExternalOneByteStringResource<span style=color:#f92672>*</span> resource <span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>new</span> ExternalOwningOneByteStringResource(std<span style=color:#f92672>::</span>move(file));
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> String<span style=color:#f92672>::</span>NewExternalOneByte(isolate, resource).ToLocalChecked();
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> String<span style=color:#f92672>::</span>NewFromUtf8(isolate, chars, NewStringType<span style=color:#f92672>::</span>kNormal, size)
</span></span><span style=display:flex><span>                 .ToLocalChecked();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> result;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><div class=highlight title=src/base/platform/platform-posix.cc><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">629
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">630
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">631
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">632
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">633
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">634
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">635
</span><span style=background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">636
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">637
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">638
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">639
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">640
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">641
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">642
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">643
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">644
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">645
</span><span style=background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">646
</span></span><span style=background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">647
</span></span><span style=background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">648
</span></span><span style=background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">649
</span></span><span style=background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">650
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">651
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">652
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">653
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">654
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">655
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">656
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">657
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-cpp data-lang=cpp><span style=display:flex><span>OS<span style=color:#f92672>::</span>MemoryMappedFile<span style=color:#f92672>*</span> OS<span style=color:#f92672>::</span>MemoryMappedFile<span style=color:#f92672>::</span>open(<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> name,
</span></span><span style=display:flex><span>                                                 FileMode mode) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span><span style=color:#f92672>*</span> fopen_mode <span style=color:#f92672>=</span> (mode <span style=color:#f92672>==</span> FileMode<span style=color:#f92672>::</span>kReadOnly) <span style=color:#f92672>?</span> <span style=color:#e6db74>&#34;r&#34;</span> <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;r+&#34;</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>struct</span> <span style=color:#a6e22e>stat</span> statbuf;
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Make sure path exists and is not a directory.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> (stat(name, <span style=color:#f92672>&amp;</span>statbuf) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>S_ISDIR(statbuf.st_mode)) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (FILE<span style=color:#f92672>*</span> file <span style=color:#f92672>=</span> fopen(name, fopen_mode)) {
</span></span><span style=display:flex;background-color:#3c3d38><span>      <span style=color:#66d9ef>if</span> (fseek(file, <span style=color:#ae81ff>0</span>, SEEK_END) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>long</span> size <span style=color:#f92672>=</span> ftell(file);  <span style=color:#75715e>// NOLINT(runtime/int)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> (size <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> PosixMemoryMappedFile(file, <span style=color:#66d9ef>nullptr</span>, <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (size <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>int</span> prot <span style=color:#f92672>=</span> PROT_READ;
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>int</span> flags <span style=color:#f92672>=</span> MAP_PRIVATE;
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (mode <span style=color:#f92672>==</span> FileMode<span style=color:#f92672>::</span>kReadWrite) {
</span></span><span style=display:flex><span>            prot <span style=color:#f92672>|=</span> PROT_WRITE;
</span></span><span style=display:flex><span>            flags <span style=color:#f92672>=</span> MAP_SHARED;
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex;background-color:#3c3d38><span>          <span style=color:#66d9ef>void</span><span style=color:#f92672>*</span> <span style=color:#66d9ef>const</span> memory <span style=color:#f92672>=</span>
</span></span><span style=display:flex;background-color:#3c3d38><span>              mmap(OS<span style=color:#f92672>::</span>GetRandomMmapAddr(), size, prot, flags, fileno(file), <span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex;background-color:#3c3d38><span>          <span style=color:#66d9ef>if</span> (memory <span style=color:#f92672>!=</span> MAP_FAILED) {
</span></span><span style=display:flex;background-color:#3c3d38><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>PosixMemoryMappedFile</span>(file, memory, size);
</span></span><span style=display:flex;background-color:#3c3d38><span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      fclose(file);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nullptr</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>If you feel overwhelmed by above functions, don&rsquo;t worry, I did too. But focus on
highlighted lines, I added the functions because they are so interesting. Source
file can be very small as our <code>debug.js</code>, or very large, I actually don&rsquo;t know
if ECMAScript has a spec for max source size or not. But anyway, V8 scanner will
scan source code token by token, so loading the whole file into memory is not
efficient. And there will be tons of small <code>read, seek</code> operations on source
file. Even though kernel code is very fast to do such operations, we can still
improve by using <code>mmap</code> You can take a break on this
blog, go checkout
<a href="https://youtu.be/8hVLcyBkSXY?t=247" class=external-link target=_blank rel=noopener>explaination video of <code>mmap</code></a>
and then come back.<br><em>(*) Disclaimer: At the time of writing this part, I also discover <code>mmap</code>. So
my explaination can be incorrect.</em></p><p>Hey, you&rsquo;re back. So you know what&rsquo;s nice about <code>mmap</code>.
Hence, V8 only seeks for the end of file position to know file size and then
maps source file to a address in <code>V8</code> virtual memory space. Run <code>thread step-out</code>
or <code>f</code> to jump up to <code>Execute</code> function.
Now we can check if source informaiton is handled correctly.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>(</span>lldb<span style=color:#f92672>)</span> p arg
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>const char *<span style=color:#f92672>)</span> $48 <span style=color:#f92672>=</span> 0x000000016fdff555 <span style=color:#e6db74>&#34;debug.js&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>lldb<span style=color:#f92672>)</span> p source-&gt;Length<span style=color:#f92672>()</span>
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>int<span style=color:#f92672>)</span> $49 <span style=color:#f92672>=</span> <span style=color:#ae81ff>55</span>
</span></span></code></pre></div><p>File name is correct, and content length looks good.</p><p>Next, <code>v8::Shell::ExecuteString</code> function call will execute our source script.
We set a breakpoint at that function and continue process.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>(</span>lldb<span style=color:#f92672>)</span> b v8::Shell::ExecuteString
</span></span><span style=display:flex><span>Breakpoint 1: where <span style=color:#f92672>=</span> d8<span style=color:#e6db74>`</span>v8::Shell::ExecuteString<span style=color:#f92672>(</span>v8::Isolate*, v8::Local&lt;v8::String&gt;, v8::Local&lt;v8::String&gt;, v8::Shell::PrintResult, v8::Shell::ReportExceptions, v8::Shell::ProcessMessageQueue<span style=color:#f92672>)</span> + <span style=color:#ae81ff>140</span> at d8.cc:685:15, address <span style=color:#f92672>=</span> 0x000000010002b2bc
</span></span><span style=display:flex><span>c
</span></span><span style=display:flex><span>* thread <span style=color:#75715e>#1, queue = &#39;com.apple.main-thread&#39;, stop reason = breakpoint 1.1</span>
</span></span><span style=display:flex><span>    frame <span style=color:#75715e>#0: 0x000000010002b2bc d8`v8::Shell::ExecuteString(isolate=0x0000000118110000, source=(val_ = 0x0000000102020060), name=(val_ = 0x0000000102020058), print_result=kNoPrintResult, report_exceptions=kReportExceptions, process_message_queue=kProcessMessageQueue) at d8.cc:685:15</span>
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>682</span> 	                          Local&lt;String&gt; name, PrintResult print_result,
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>683</span> 	                          ReportExceptions report_exceptions,
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>684</span> 	                          ProcessMessageQueue process_message_queue<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>-&gt; <span style=color:#ae81ff>685</span> 	  i::Isolate* i_isolate <span style=color:#f92672>=</span> reinterpret_cast&lt;i::Isolate*&gt;<span style=color:#f92672>(</span>isolate<span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>686</span> 	  <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>i::FLAG_parse_only<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>687</span> 	    i::VMState&lt;PARSER&gt; state<span style=color:#f92672>(</span>i_isolate<span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>   <span style=color:#ae81ff>688</span> 	    i::Handle&lt;i::String&gt; str <span style=color:#f92672>=</span> Utils::OpenHandle<span style=color:#f92672>(</span>*<span style=color:#f92672>(</span>source<span style=color:#f92672>))</span>;
</span></span><span style=display:flex><span>Target 0: <span style=color:#f92672>(</span>d8<span style=color:#f92672>)</span> stopped.
</span></span></code></pre></div><p>In this function, <code>d8</code> opens the source and parse script inside it.</p><div class=highlight title=src/d8.cc><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">703
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">704
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">705
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">706
</span><span style=background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">707
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">708
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">709
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">710
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">711
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">712
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">713
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">714
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">715
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">716
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-cpp data-lang=cpp><span style=display:flex><span>    i<span style=color:#f92672>::</span>ParseInfo parse_info(i_isolate, flags, <span style=color:#f92672>&amp;</span>compile_state, <span style=color:#f92672>&amp;</span>reusable_state);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    i<span style=color:#f92672>::</span>Handle<span style=color:#f92672>&lt;</span>i<span style=color:#f92672>::</span>Script<span style=color:#f92672>&gt;</span> script <span style=color:#f92672>=</span> parse_info.CreateScript(
</span></span><span style=display:flex><span>        i_isolate, str, i<span style=color:#f92672>::</span>kNullMaybeHandle, ScriptOriginOptions());
</span></span><span style=display:flex;background-color:#3c3d38><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>i<span style=color:#f92672>::</span>parsing<span style=color:#f92672>::</span>ParseProgram(<span style=color:#f92672>&amp;</span>parse_info, script, i_isolate,
</span></span><span style=display:flex><span>                                  i<span style=color:#f92672>::</span>parsing<span style=color:#f92672>::</span>ReportStatisticsMode<span style=color:#f92672>::</span>kYes)) {
</span></span><span style=display:flex><span>      parse_info.pending_error_handler()<span style=color:#f92672>-&gt;</span>PrepareErrors(
</span></span><span style=display:flex><span>          i_isolate, parse_info.ast_value_factory());
</span></span><span style=display:flex><span>      parse_info.pending_error_handler()<span style=color:#f92672>-&gt;</span>ReportErrors(i_isolate, script);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      fprintf(stderr, <span style=color:#e6db74>&#34;Failed parsing</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>return</span> false;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> true;
</span></span></code></pre></td></tr></table></div></div><p>Hopefully now you are more familiar with <code>lldb</code> step movements like step over,
step into, adding breakpoint and continue to next breakpoint. I will skip <code>lldb</code>
commands like <code>run, breakpoint set, continue, thread step-in, thread step-out</code>.</p><p>Now we take a look at <code>v8::internal::parsing::ParseProgram</code> function. Because it
is short, I put the whole function code here.</p><div class=highlight title=src/parsing/parsing.cc><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#66d9ef>bool</span> <span style=color:#a6e22e>ParseProgram</span>(ParseInfo<span style=color:#f92672>*</span> info, Handle<span style=color:#f92672>&lt;</span>Script<span style=color:#f92672>&gt;</span> script,
</span></span><span style=display:flex><span>                  MaybeHandle<span style=color:#f92672>&lt;</span>ScopeInfo<span style=color:#f92672>&gt;</span> maybe_outer_scope_info,
</span></span><span style=display:flex><span>                  Isolate<span style=color:#f92672>*</span> isolate, ReportStatisticsMode mode) {
</span></span><span style=display:flex><span>  DCHECK(info<span style=color:#f92672>-&gt;</span>flags().is_toplevel());
</span></span><span style=display:flex><span>  DCHECK_NULL(info<span style=color:#f92672>-&gt;</span>literal());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  VMState<span style=color:#f92672>&lt;</span>PARSER<span style=color:#f92672>&gt;</span> state(isolate);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Create a character stream for the parser.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  Handle<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> source(String<span style=color:#f92672>::</span>cast(script<span style=color:#f92672>-&gt;</span>source()), isolate);
</span></span><span style=display:flex><span>  isolate<span style=color:#f92672>-&gt;</span>counters()<span style=color:#f92672>-&gt;</span>total_parse_size()<span style=color:#f92672>-&gt;</span>Increment(source<span style=color:#f92672>-&gt;</span>length());
</span></span><span style=display:flex><span>  std<span style=color:#f92672>::</span>unique_ptr<span style=color:#f92672>&lt;</span>Utf16CharacterStream<span style=color:#f92672>&gt;</span> stream(
</span></span><span style=display:flex><span>      ScannerStream<span style=color:#f92672>::</span>For(isolate, source));
</span></span><span style=display:flex><span>  info<span style=color:#f92672>-&gt;</span>set_character_stream(std<span style=color:#f92672>::</span>move(stream));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Parser parser(isolate<span style=color:#f92672>-&gt;</span>main_thread_local_isolate(), info, script);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Ok to use Isolate here; this function is only called in the main thread.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  DCHECK(parser.parsing_on_main_thread_);
</span></span><span style=display:flex><span>  parser.ParseProgram(isolate, script, info, maybe_outer_scope_info);
</span></span><span style=display:flex><span>  MaybeReportStatistics(info, script, isolate, <span style=color:#f92672>&amp;</span>parser, mode);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> info<span style=color:#f92672>-&gt;</span>literal() <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nullptr</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>As you can see, we read source code by a character stream, but at this point,
our stream is still empty. Let&rsquo;s step into <code>parser.ParseProgram</code> call.</p><div class=highlight title=src/parsing/parser.cc><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">536
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">537
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">538
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">539
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">540
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">541
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">542
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">543
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">544
</span><span style=background-color:#3c3d38><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">545
</span></span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">546
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">547
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">548
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid><code class=language-cpp data-lang=cpp><span style=display:flex><span>  <span style=color:#75715e>// Initialize parser state.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  DeserializeScopeChain(isolate, info, maybe_outer_scope_info,
</span></span><span style=display:flex><span>                        Scope<span style=color:#f92672>::</span>DeserializationMode<span style=color:#f92672>::</span>kIncludingVariables);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  DCHECK_EQ(script<span style=color:#f92672>-&gt;</span>is_wrapped(), info<span style=color:#f92672>-&gt;</span>is_wrapped_as_function());
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (script<span style=color:#f92672>-&gt;</span>is_wrapped()) {
</span></span><span style=display:flex><span>    maybe_wrapped_arguments_ <span style=color:#f92672>=</span> handle(script<span style=color:#f92672>-&gt;</span>wrapped_arguments(), isolate);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex;background-color:#3c3d38><span>  scanner_.Initialize();
</span></span><span style=display:flex><span>  FunctionLiteral<span style=color:#f92672>*</span> result <span style=color:#f92672>=</span> DoParseProgram(isolate, info);
</span></span><span style=display:flex><span>  MaybeProcessSourceRanges(info, result, stack_limit_);
</span></span><span style=display:flex><span>  PostProcessParseResult(isolate, info, result);
</span></span></code></pre></td></tr></table></div></div><p>After a few internal checks, the <code>scanner</code> start initializing. This is where our
code being translated to Javascript lexical elements. The structure of scanner
source stream is documented in header file.</p><div class=highlight title=src/parsing/scanner.h><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">193
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">194
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">195
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">196
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">197
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">198
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">199
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">200
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">201
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">202
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>Fields describing the location of the current buffer physically in memory,
</span></span><span style=display:flex><span>and semantically within the source string.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                 0              buffer_pos_   pos()
</span></span><span style=display:flex><span>                 |                        |   |
</span></span><span style=display:flex><span>                 v________________________v___v_____________
</span></span><span style=display:flex><span>                 |                        |        |        |
</span></span><span style=display:flex><span>  Source string: |                        | Buffer |        |
</span></span><span style=display:flex><span>                 |________________________|________|________|
</span></span><span style=display:flex><span>                                          ^   ^    ^
</span></span><span style=display:flex><span>                                          |   |    |
</span></span><span style=display:flex><span>                  Pointers:   buffer_start_   |    buffer_end_
</span></span><span style=display:flex><span>                                        buffer_cursor_
</span></span></code></pre></td></tr></table></div></div><p>Let&rsquo;s checkout what is in current buffer.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>(</span>lldb<span style=color:#f92672>)</span> p scanner<span style=color:#f92672>()</span>-&gt;source_-&gt;buffer_start_
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>const uint16_t *<span style=color:#f92672>)</span> $40 <span style=color:#f92672>=</span> 0x0000000102016032
</span></span><span style=display:flex><span><span style=color:#f92672>(</span>lldb<span style=color:#f92672>)</span> x/s 0x0000000102016032
</span></span><span style=display:flex><span>0x102016032: <span style=color:#e6db74>&#34;l&#34;</span>
</span></span></code></pre></div><p>We got our first character of source file ( <code>l</code> in <code>let</code> keywork). Because we
knew source length is 55. We can print out the whole file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>(</span>lldb<span style=color:#f92672>)</span> x/55s 0x0000000102016032
</span></span><span style=display:flex><span>0x102016032: <span style=color:#e6db74>&#34;l&#34;</span>
</span></span><span style=display:flex><span>0x102016034: <span style=color:#e6db74>&#34;e&#34;</span>
</span></span><span style=display:flex><span>0x102016036: <span style=color:#e6db74>&#34;t&#34;</span>
</span></span><span style=display:flex><span>0x102016038: <span style=color:#e6db74>&#34; &#34;</span>
</span></span><span style=display:flex><span>0x10201603a: <span style=color:#e6db74>&#34;a&#34;</span>
</span></span><span style=display:flex><span>0x10201603c: <span style=color:#e6db74>&#34; &#34;</span>
</span></span><span style=display:flex><span>0x10201603e: <span style=color:#e6db74>&#34;=&#34;</span>
</span></span><span style=display:flex><span>0x102016040: <span style=color:#e6db74>&#34; &#34;</span>
</span></span><span style=display:flex><span>0x102016042: <span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>0x102016044: <span style=color:#e6db74>&#34;\n&#34;</span>
</span></span><span style=display:flex><span>0x102016046: <span style=color:#e6db74>&#34;v&#34;</span>
</span></span><span style=display:flex><span>0x102016048: <span style=color:#e6db74>&#34;a&#34;</span>
</span></span><span style=display:flex><span>0x10201604a: <span style=color:#e6db74>&#34;r&#34;</span>
</span></span><span style=display:flex><span>0x10201604c: <span style=color:#e6db74>&#34; &#34;</span>
</span></span><span style=display:flex><span>0x10201604e: <span style=color:#e6db74>&#34;b&#34;</span>
</span></span><span style=display:flex><span>0x102016050: <span style=color:#e6db74>&#34; &#34;</span>
</span></span><span style=display:flex><span>0x102016052: <span style=color:#e6db74>&#34;=&#34;</span>
</span></span><span style=display:flex><span>0x102016054: <span style=color:#e6db74>&#34; &#34;</span>
</span></span><span style=display:flex><span>0x102016056: <span style=color:#e6db74>&#34;2&#34;</span>
</span></span><span style=display:flex><span>0x102016058: <span style=color:#e6db74>&#34;\n&#34;</span>
</span></span><span style=display:flex><span>0x10201605a: <span style=color:#e6db74>&#34;c&#34;</span>
</span></span><span style=display:flex><span>0x10201605c: <span style=color:#e6db74>&#34;o&#34;</span>
</span></span><span style=display:flex><span>0x10201605e: <span style=color:#e6db74>&#34;n&#34;</span>
</span></span><span style=display:flex><span>0x102016060: <span style=color:#e6db74>&#34;s&#34;</span>
</span></span><span style=display:flex><span>0x102016062: <span style=color:#e6db74>&#34;t&#34;</span>
</span></span><span style=display:flex><span>0x102016064: <span style=color:#e6db74>&#34; &#34;</span>
</span></span><span style=display:flex><span>0x102016066: <span style=color:#e6db74>&#34;c&#34;</span>
</span></span><span style=display:flex><span>0x102016068: <span style=color:#e6db74>&#34; &#34;</span>
</span></span><span style=display:flex><span>0x10201606a: <span style=color:#e6db74>&#34;=&#34;</span>
</span></span><span style=display:flex><span>0x10201606c: <span style=color:#e6db74>&#34; &#34;</span>
</span></span><span style=display:flex><span>0x10201606e: <span style=color:#e6db74>&#34;3&#34;</span>
</span></span><span style=display:flex><span>0x102016070: <span style=color:#e6db74>&#34;\n&#34;</span>
</span></span><span style=display:flex><span>0x102016072: <span style=color:#e6db74>&#34;c&#34;</span>
</span></span><span style=display:flex><span>0x102016074: <span style=color:#e6db74>&#34;o&#34;</span>
</span></span><span style=display:flex><span>0x102016076: <span style=color:#e6db74>&#34;n&#34;</span>
</span></span><span style=display:flex><span>0x102016078: <span style=color:#e6db74>&#34;s&#34;</span>
</span></span><span style=display:flex><span>0x10201607a: <span style=color:#e6db74>&#34;o&#34;</span>
</span></span><span style=display:flex><span>0x10201607c: <span style=color:#e6db74>&#34;l&#34;</span>
</span></span><span style=display:flex><span>0x10201607e: <span style=color:#e6db74>&#34;e&#34;</span>
</span></span><span style=display:flex><span>0x102016080: <span style=color:#e6db74>&#34;.&#34;</span>
</span></span><span style=display:flex><span>0x102016082: <span style=color:#e6db74>&#34;l&#34;</span>
</span></span><span style=display:flex><span>0x102016084: <span style=color:#e6db74>&#34;o&#34;</span>
</span></span><span style=display:flex><span>0x102016086: <span style=color:#e6db74>&#34;g&#34;</span>
</span></span><span style=display:flex><span>0x102016088: <span style=color:#e6db74>&#34;(&#34;</span>
</span></span><span style=display:flex><span>0x10201608a: <span style=color:#e6db74>&#34;a&#34;</span>
</span></span><span style=display:flex><span>0x10201608c: <span style=color:#e6db74>&#34; &#34;</span>
</span></span><span style=display:flex><span>0x10201608e: <span style=color:#e6db74>&#34;+&#34;</span>
</span></span><span style=display:flex><span>0x102016090: <span style=color:#e6db74>&#34; &#34;</span>
</span></span><span style=display:flex><span>0x102016092: <span style=color:#e6db74>&#34;b&#34;</span>
</span></span><span style=display:flex><span>0x102016094: <span style=color:#e6db74>&#34; &#34;</span>
</span></span><span style=display:flex><span>0x102016096: <span style=color:#e6db74>&#34;+&#34;</span>
</span></span><span style=display:flex><span>0x102016098: <span style=color:#e6db74>&#34; &#34;</span>
</span></span><span style=display:flex><span>0x10201609a: <span style=color:#e6db74>&#34;c&#34;</span>
</span></span><span style=display:flex><span>0x10201609c: <span style=color:#e6db74>&#34;)&#34;</span>
</span></span><span style=display:flex><span>0x10201609e: <span style=color:#e6db74>&#34;\n&#34;</span>
</span></span></code></pre></div><p>That&rsquo;s exact our script from very first part.
Wow! I can&rsquo;t believe we go this far. But it&rsquo;s just the beginning. I&rsquo;ll see you
next time.</p></div><footer><section class=see-also></section></footer></article></section></div><footer class=footer><section class=container>©
2021 -
2025
Sy Tran
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>