<!doctype html><html lang=en><head><title>Is Even or Is Not Even ¬∑ sytranvn.dev
</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Sy Tran"><meta name=description content="Recently I came acrosss a LinkedIn post where someone said: in order to improve
isEven(n: number) performance, we can use bitwise operator instead of modulo.
At a glance I totally agree with that oppinion.
"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Is Even or Is Not Even"><meta name=twitter:description content="Recently I came acrosss a LinkedIn post where someone said: in order to improve
isEven(n: number) performance, we can use bitwise operator instead of modulo.
At a glance I totally agree with that oppinion."><meta property="og:url" content="https://sytranvn.dev/posts/is-even-or-is-not-even/"><meta property="og:site_name" content="sytranvn.dev"><meta property="og:title" content="Is Even or Is Not Even"><meta property="og:description" content="Recently I came acrosss a LinkedIn post where someone said: in order to improve
isEven(n: number) performance, we can use bitwise operator instead of modulo.
At a glance I totally agree with that oppinion."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-02-21T22:29:37+07:00"><meta property="article:modified_time" content="2025-02-21T22:29:37+07:00"><meta property="article:tag" content="Bitwise"><meta property="article:tag" content="Javascripts"><meta property="article:tag" content="C"><meta property="og:see_also" content="https://sytranvn.dev/posts/is-even-or-is-not-even-2/"><link rel=canonical href=https://sytranvn.dev/posts/is-even-or-is-not-even/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.7763f8bc6341ecf82378e867c285e1549abb063a899be313ccd25dbfcd24fa7d.css integrity="sha256-d2P4vGNB7PgjeOhnwoXhVJq7BjqJm+MTzNJdv80k+n0=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/custom.min.14b400827539da755b0d46f2e69147089c47acc5e169eaa464caf99e0bc9fd38.css integrity="sha256-FLQAgnU52nVbDUby5pFHCJxHrMXhaeqkZMr5ngvJ/Tg=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://sytranvn.dev/>sytranvn.dev
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/now/>Now</a></li><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=/i-heart-oss/>I ‚ù§Ô∏è OSS</a></li><li class=navigation-item><a class=navigation-link href=/accomplishments/>Accomplishments</a></li><li class=navigation-item><a class=navigation-link href=/resume.pdf>Resume</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=/vi/>üáªüá≥</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://sytranvn.dev/posts/is-even-or-is-not-even/>Is Even or Is Not Even</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2025-02-21T22:29:37+07:00>February 21, 2025
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
4-minute read</span></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/bitwise/>Bitwise</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/tags/javascripts/>Javascripts</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/tags/c/>C</a></span></div></div><script id=diffblog-plugin-script async src=https://diff.blog/static/js/diffblog_plugin_v1.js></script><script>document.getElementById("diffblog-plugin-script").addEventListener("load",function(){DiffBlog("4at5qx7n0j5yhd86rqu6gyotkgn4o17hu8wn6xis54lwd692ez")})</script></header><div class=post-content>Recently I came acrosss a LinkedIn post where someone said: in order to improve
isEven(n: number) performance, we can use bitwise operator instead of modulo.
At a glance I totally agree with that oppinion.<p>However, when I look closely to the code, I realized something wasn&rsquo;t right. I
can&rsquo;t find the original post, so this is what I remember. The function is short
so I believe I won&rsquo;t mess anything up.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>function</span> <span class=nx>isEven</span><span class=p>(</span><span class=nx>n</span>: <span class=kt>number</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=nx>n</span> <span class=o>^</span> <span class=mi>1</span><span class=p>)</span> <span class=o>===</span> <span class=p>(</span><span class=nx>n</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>In Javascripts, a number can be an <code>integer</code>, <code>decimal</code>, or <code>NaN</code>, or <code>Inf</code> or
event <code>BigInt</code>. But let&rsquo;s assume we only use this for <code>integer</code>.</p><p>This piece of code is wrong. If we plug a very &ldquo;small&rdquo; negative number in, for
example, <code>-9007199249885170</code> which is greater than <code>Number.MIN_SAFE_INTEGER = -(2^53-1)</code> is a safe integer. We get</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kr>const</span> <span class=nx>n</span> <span class=o>=</span> <span class=o>-</span><span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=nx>isEven</span><span class=p>(</span><span class=nx>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>//true
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>a</span> <span class=o>=</span> <span class=o>-</span><span class=mi>9007199249885170</span>
</span></span><span class=line><span class=cl><span class=nx>isEven</span><span class=p>(</span><span class=nx>a</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// false
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>a</span><span class=o>^</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=c1>// 4855823 - WHAT????
</span></span></span></code></pre></div><p>We thought we only flipped the last bit (or index 0 bit) of <code>a</code> but somehow everything is messed
up. This is so interesting but I think it deserves an other post when I dive
deep into Javascripts 54 bits two&rsquo;s complement integer. But for now, let&rsquo;s stick with
the original problem.</p><p>So, normally, we would do <code>n & 1 === 0</code> to check even number instead.</p><p>We can write a simple test to prove our assumption</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=kd>function</span> <span class=nx>realEven</span><span class=p>(</span><span class=nx>n</span>: <span class=kt>number</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=nx>n</span> <span class=o>%</span> <span class=mi>2</span><span class=p>)</span> <span class=o>===</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>checkEvenFunction</span><span class=p>(</span><span class=nx>isEvenFn</span><span class=o>:</span> <span class=p>(</span><span class=nx>n</span>: <span class=kt>number</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=kr>boolean</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kd>let</span> <span class=nx>i</span> <span class=o>=</span> <span class=nb>Number</span><span class=p>.</span><span class=nx>MIN_SAFE_INTEGER</span><span class=p>;</span> <span class=nx>i</span> <span class=o>&lt;=</span> <span class=nb>Number</span><span class=p>.</span><span class=nx>MAX_SAFE_INTEGER</span><span class=p>;</span> <span class=nx>i</span> <span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>assert</span><span class=p>.</span><span class=nx>equal</span><span class=p>(</span><span class=nx>isEvenFn</span><span class=p>(</span><span class=nx>i</span><span class=p>),</span> <span class=nx>realEven</span><span class=p>(</span><span class=nx>i</span><span class=p>),</span> <span class=nx>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>isEvenXor</span><span class=p>(</span><span class=nx>n</span>: <span class=kt>number</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=nx>n</span> <span class=o>^</span> <span class=mi>1</span><span class=p>)</span> <span class=o>===</span> <span class=p>(</span><span class=nx>n</span> <span class=o>+</span> <span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>isEvenAnd</span><span class=p>(</span><span class=nx>n</span>: <span class=kt>number</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=nx>n</span> <span class=o>&amp;</span> <span class=mi>1</span><span class=p>)</span> <span class=o>===</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>And then call</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=nx>checkEvenFunction</span><span class=p>(</span><span class=nx>isEvenXor</span><span class=p>);</span>
</span></span></code></pre></div><p>And</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=nx>checkEvenFunction</span><span class=p>(</span><span class=nx>isEvenAnd</span><span class=p>);</span>
</span></span></code></pre></div><p>üò™ I hope you didn&rsquo;t try this.</p><p>Anyway, we have learned how not to check an integer is even in Javascripts. And
we&rsquo;ve done.</p><p>Scrolling through comments of the LinkedIn post, there&rsquo;s a guy who claimed to
be a compiler designer. And he said using <code>%</code> or <code>&</code> don&rsquo;t matter, because
compilers are smart enough to optimize it. ü§î an other &ldquo;wait a minute&rdquo; moment.</p><p>So he&rsquo;s saying that I have been writing <code>&</code> the whole time without improving
any nanosecond of my Leetcode solutions? IT CAN&rsquo;T BE!!! But he&rsquo;s a compiler
designer, he ain&rsquo;t be wrong&mldr; Ok, I have to do fact check myself. Can&rsquo;t let
this slip through.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>a</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>a</span> <span class=o>%</span> <span class=mi>2</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;a is odd</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>This is straight forward check, we need to read <code>a</code> from <code>stdin</code> otherwise compiler
would evaluate <code>a % 2</code> at compile time and eliminate redundant code.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>gcc main.c -o main
</span></span><span class=line><span class=cl>objdump --disassemble-symbol<span class=o>=</span>main
</span></span></code></pre></div><p>Let&rsquo;s checkout the actual assembly code. You can view full assembly code here
<a href=https://godbolt.org/z/475d1n7KK class=external-link target=_blank rel=noopener>Online Compiler</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=c1>// gcc -g -o output.s -masm=intel -fno-verbose-asm -S -fdiagnostics-color=always example.cpp
</span></span></span><span class=line><span class=cl><span class=c1>// ....
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=no>DWORD</span> <span class=no>PTR</span> <span class=p>[</span><span class=no>rbp-4</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>and</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=nf>test</span>    <span class=no>eax</span><span class=p>,</span> <span class=no>eax</span>
</span></span><span class=line><span class=cl>        <span class=nf>je</span>      <span class=no>.L2</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>edi</span><span class=p>,</span> <span class=no>OFFSET</span> <span class=no>FLAT</span><span class=p>:.</span><span class=no>LC1</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>puts</span>
</span></span><span class=line><span class=cl><span class=nl>.L2:</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=nf>leave</span>
</span></span><span class=line><span class=cl>        <span class=nf>ret</span>
</span></span></code></pre></div><p>Without any optimization flag, gcc changes <code>a % 2</code> to <code>a & 1</code> .</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=c1>// clang -O0 ...
</span></span></span><span class=line><span class=cl><span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>mov</span>     <span class=no>eax</span><span class=p>,</span> <span class=no>dword</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>rbp</span> <span class=p>-</span> <span class=mi>8</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>ecx</span><span class=p>,</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>        <span class=nf>cdq</span>
</span></span><span class=line><span class=cl>        <span class=nf>idiv</span>    <span class=no>ecx</span>
</span></span><span class=line><span class=cl>        <span class=nf>cmp</span>     <span class=no>edx</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=nf>je</span>      <span class=no>.LBB0_2</span>
</span></span><span class=line><span class=cl>        <span class=nf>lea</span>     <span class=no>rdi</span><span class=p>,</span> <span class=p>[</span><span class=no>rip</span> <span class=err>+</span> <span class=no>.L.str.1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>mov</span>     <span class=no>al</span><span class=p>,</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>printf@PLT</span>
</span></span></code></pre></div><p><a href=https://godbolt.org/z/xPj7n78fG class=external-link target=_blank rel=noopener>No optimization flag -O0</a>
For clang, it still use <code>idiv</code> and get modulo from <code>edx</code> registry. Therefore,
without optimization flag, clang keep our code as it is.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-asm data-lang=asm><span class=line><span class=cl><span class=c1>// clang -O3
</span></span></span><span class=line><span class=cl><span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>test</span>    <span class=no>byte</span> <span class=no>ptr</span> <span class=p>[</span><span class=no>rsp</span> <span class=err>+</span> <span class=mi>4</span><span class=p>],</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=nf>je</span>      <span class=no>.LBB0_2</span>
</span></span><span class=line><span class=cl>        <span class=nf>lea</span>     <span class=no>rdi</span><span class=p>,</span> <span class=p>[</span><span class=no>rip</span> <span class=err>+</span> <span class=no>.Lstr</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nf>call</span>    <span class=no>puts@PLT</span>
</span></span></code></pre></div><p><a href=https://godbolt.org/z/jexxr9hW9 class=external-link target=_blank rel=noopener>Aggressive optimization flag -O3</a>
Trying optimization flag from <code>-O1</code> to <code>-O3</code> give the same result. We see clang
use <code>test</code> instruction to compare bits of <code>a</code> with number <code>1</code>. It is equivalent
of <code>a & 1</code>. So we can conclude that clang also optimize modulo check if we ask
for optimization.</p><p>Note that this only work with <code>if (n % 2)</code> check, not assignment expression
like <code>int x = n % 2</code>. Because the result would be assigned to <code>x</code> and negative
numbers have negative modulo. Therefore, compiler can&rsquo;t replace it with <code>& 1</code> always
produce either <code>0</code> or <code>1</code>.</p><p>And according to this <a href=https://support.leetcode.com/hc/en-us/articles/360011833974-What-are-the-environments-for-the-programming-languages class=external-link target=_blank rel=noopener>article from
Leetcode</a>,
they compile <code>C/C++</code> with <code>-O2</code> flag. So my <code>n & 1</code> manual optimization is
wasted ü§£</p><p>Now I wonder how V8 optimize this kind of logic with integer number ü§î . I don&rsquo;t have
<code>d8</code> built on my computer now, so this has to be delayed a bit.</p></div><footer><section class=see-also><h3 id=see-also-in-is-even-or-is-not-even-check>See also in Is-even-or-is-not-even-check
<a class=heading-link href=#see-also-in-is-even-or-is-not-even-check><i class="fa-solid fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h3><nav><ul><li><a href=/posts/is-even-or-is-not-even-2/>Is Even or Is Not Even (part 2)</a></li></ul></nav></section></footer></article></section></div><footer class=footer><section class=container>¬©
2021 -
2025
Sy Tran
¬∑
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>