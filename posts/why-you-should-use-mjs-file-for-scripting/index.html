<!doctype html><html lang=en>
<head>
<title>
Why you should use Javascripts for scripting · sytranvn.dev
</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=color-scheme content="light dark">
<meta name=author content="Sy Tran">
<meta name=description content="I like to write small scripts, but used to suggle when I want to use Javascript to fetch API data, or use some helper packages. Then I go with Python instead. But things have changed. With the supports of ES module and fetch and node:module API. It is much easier now since I feel more comfortable using JS.
Unlike normal js files, node treats mjs files as ECMAScript modules. So it means you can use any supported ES-next features w/o a transpiler like Babel.">
<meta name=keywords content="blog,developer,personal">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Why you should use Javascripts for scripting">
<meta name=twitter:description content="I like to write small scripts, but used to suggle when I want to use Javascript to fetch API data, or use some helper packages. Then I go with Python instead. But things have changed. With the supports of ES module and fetch and node:module API. It is much easier now since I feel more comfortable using JS.
Unlike normal js files, node treats mjs files as ECMAScript modules. So it means you can use any supported ES-next features w/o a transpiler like Babel.">
<meta property="og:title" content="Why you should use Javascripts for scripting">
<meta property="og:description" content="I like to write small scripts, but used to suggle when I want to use Javascript to fetch API data, or use some helper packages. Then I go with Python instead. But things have changed. With the supports of ES module and fetch and node:module API. It is much easier now since I feel more comfortable using JS.
Unlike normal js files, node treats mjs files as ECMAScript modules. So it means you can use any supported ES-next features w/o a transpiler like Babel.">
<meta property="og:type" content="article">
<meta property="og:url" content="http://sytranvn.dev/posts/why-you-should-use-mjs-file-for-scripting/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2023-02-10T00:00:00+00:00">
<meta property="article:modified_time" content="2023-02-10T00:00:00+00:00">
<link rel=canonical href=http://sytranvn.dev/posts/why-you-should-use-mjs-file-for-scripting/>
<link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin>
<link rel=stylesheet href=/css/coder.min.5adbe72fc41dcfb852215b84695288939b6b606db73238bd3ee936469572fc9c.css integrity="sha256-WtvnL8Qdz7hSIVuEaVKIk5trYG23Mji9Puk2RpVy/Jw=" crossorigin=anonymous media=screen>
<link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen>
<link rel=stylesheet href=/css/custom.min.ca5f874b88e4c402f234bf2bf910a86f104289167117a551cbdc8d6d7642cf60.css integrity="sha256-yl+HS4jkxALyNL8r+RCobxBCiRZxF6VRy9yNbXZCz2A=" crossorigin=anonymous media=screen>
<link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any>
<link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16>
<link rel=apple-touch-icon href=/images/apple-touch-icon.png>
<link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png>
<link rel=manifest href=/site.webmanifest>
<link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5>
</head>
<body class="preload-transitions colorscheme-dark">
<main class=wrapper>
<nav class=navigation>
<section class=container>
<a class=navigation-title href=/>
sytranvn.dev
</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle>
<i class="fa fa-bars fa-fw" aria-hidden=true></i>
</label>
<ul class=navigation-list>
<li class=navigation-item>
<a class=navigation-link href=/now/>Now</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/posts/>Blog</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/projects/>Projects</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/i-heart-oss/>I ❤️ OSS</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/accomplishments/>Accomplishments</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/resume.pdf>Resume</a>
</li>
</ul>
</section>
</nav>
<div class=content>
<section class="container post">
<article>
<header>
<div class=post-title>
<h1 class=title>
<a class=title-link href=http://sytranvn.dev/posts/why-you-should-use-mjs-file-for-scripting/>
Why you should use Javascripts for scripting
</a>
</h1>
</div>
<div class=post-meta>
<div class=date>
<span class=posted-on>
<i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2023-02-10T00:00:00Z>
February 10, 2023
</time>
</span>
<span class=reading-time>
<i class="fa fa-clock-o" aria-hidden=true></i>
4-minute read
</span>
</div>
<div class=categories>
<i class="fa fa-folder" aria-hidden=true></i>
<a href=/categories/javascripts/>JavaScripts</a></div>
</div>
</header>
<div class=post-content>
<p>I like to write small scripts, but used to suggle when I want to use Javascript
to fetch API data, or use some helper packages. Then I go with Python instead.
But things have changed. With the supports of ES module and <code>fetch</code> and
<code>node:module</code> API. It is much easier now since I feel more comfortable using JS.</p>
<p>Unlike normal <code>js</code> files, node treats <code>mjs</code> files as ECMAScript modules. So
it means you can use any supported ES-next features w/o a transpiler like Babel.
In the past, to be able to use ES features, we had to set up build and compilation
tools like Webpack and Babel (due to conflicts between common JS <code>require</code> is
synchronous but <code>import</code> is asynchronous, NodeJS didn&rsquo;t support import/export
natively until node 13). Webpack and Babel are not ment to do the jobs of Node.
anymore. We should use them now when we need code bundling and compile some
other language to JS such as JSX or new ES proposals still in staging. And even
worse, sometimes they can even hold you back from using new features added to
Javascripts if you don&rsquo;t configurate it at latest version. I have suffered so
many times that I can&rsquo;t use <code>...</code>, or <code>Array.at</code> in my code just because my
project configuration is so outdated, not to mention the over advertised
Typescripts, migrating those tools just to use a natively supported feature is
pain in the a&mldr;</p>
<p>For example I want to write a script to quickly check
current price of BTC on Binance. Write it to a json file for later if I want
to do anything with that data. And we want to do it without installing any
packages at all.</p>
<p>First of all, we know we&rsquo;ll need to write some data, so we need some helps
from Node builtin <code>fs</code> package.</p>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#fff;font-weight:700>import</span> fs from <span style=color:#0ff;font-weight:700>&#39;node:fs/promises&#39;</span>
</code></pre></div><p>Here I use <code>node:fs/promises</code>, new api return promises instead of callbacks.
And because it is builtin package, we don&rsquo;t need to install like <code>fs</code>.</p>
<p>Secondly, we need to get data from Binance API at <a href=https://api.binance.com/api/v3/ticker/price class=external-link target=_blank rel=noopener>https://api.binance.com/api/v3/ticker/price</a>.
At this point, we have Node 18 released and it added <code>fetch</code>, the dead simple
api for fetching data has been available in browsers for a long long time.
Other wise we would need to go through these tutorials again to know how to
fetch data with node <a href=https://blog.logrocket.com/5-ways-to-make-http-requests-in-node-js/ class=external-link target=_blank rel=noopener>https://blog.logrocket.com/5-ways-to-make-http-requests-in-node-js/</a></p>
<p>So our following lines of code look like this.</p>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#fff;font-weight:700>const</span> response = <span style=color:#fff;font-weight:700>await</span> fetch(<span style=color:#0ff;font-weight:700>&#39;https://api.binance.com/api/v3/ticker/price&#39;</span>)
<span style=color:#fff;font-weight:700>if</span> (response.ok) {
    <span style=color:#fff;font-weight:700>const</span> data = <span style=color:#fff;font-weight:700>await</span> response.json()
}
</code></pre></div><p>Next, I want to find the price of <code>BTC</code> to <code>USDT</code>, so let&rsquo;s loop through the
data and find it.</p>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#fff;font-weight:700>for</span> (<span style=color:#fff;font-weight:700>const</span> pair <span style=color:#fff;font-weight:700>of</span> data) {
    <span style=color:#fff;font-weight:700>if</span> (pair.symbol === <span style=color:#0ff;font-weight:700>&#39;BTCUSDT&#39;</span>) {
        console.log(<span style=color:#0ff;font-weight:700>`Current price of BTC is </span><span style=color:#0ff;font-weight:700>${</span>pair.price<span style=color:#0ff;font-weight:700>}</span><span style=color:#0ff;font-weight:700>`</span>)
        <span style=color:#fff;font-weight:700>break</span>
    }
}
</code></pre></div><p>And finally, let&rsquo;s backup our data in a file for later.</p>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#fff;font-weight:700>await</span> fs.writeFile(<span style=color:#0ff;font-weight:700>&#39;./price.json&#39;</span>, JSON.stringify(data, <span style=color:#fff;font-weight:700>null</span>, <span style=color:#ff0;font-weight:700>2</span>))
</code></pre></div><p>Let&rsquo;s put it all together.</p>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#fff;font-weight:700>import</span> fs from <span style=color:#0ff;font-weight:700>&#39;node:fs/promises&#39;</span>
<span style=color:#fff;font-weight:700>const</span> response = <span style=color:#fff;font-weight:700>await</span> fetch(<span style=color:#0ff;font-weight:700>&#39;https://api.binance.com/api/v3/ticker/price&#39;</span>)
<span style=color:#fff;font-weight:700>if</span> (response.ok) {
    <span style=color:#fff;font-weight:700>const</span> data = <span style=color:#fff;font-weight:700>await</span> response.json()
    <span style=color:#fff;font-weight:700>for</span> (<span style=color:#fff;font-weight:700>const</span> pair <span style=color:#fff;font-weight:700>of</span> data) {
        <span style=color:#fff;font-weight:700>if</span> (pair.symbol === <span style=color:#0ff;font-weight:700>&#39;BTCUSDT&#39;</span>) {
            console.log(<span style=color:#0ff;font-weight:700>`Current price of BTC is </span><span style=color:#0ff;font-weight:700>${</span>pair.price<span style=color:#0ff;font-weight:700>}</span><span style=color:#0ff;font-weight:700>`</span>)
            <span style=color:#fff;font-weight:700>break</span>
        }
    }
    <span style=color:#fff;font-weight:700>await</span> fs.writeFile(<span style=color:#0ff;font-weight:700>&#39;./price.json&#39;</span>, JSON.stringify(data, <span style=color:#fff;font-weight:700>null</span>, <span style=color:#ff0;font-weight:700>2</span>))
} <span style=color:#fff;font-weight:700>else</span> {
    console.error(<span style=color:#0ff;font-weight:700>&#39;Cannot get BTC price&#39;</span>)
    process.exit(<span style=color:#ff0;font-weight:700>1</span>)    
}
</code></pre></div><p>If you save this file as <code>price.js</code> and try to run it with <code>node price.js</code>, you
will see the following error.</p>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt>price.js:1
import fs from &#39;node:fs/promises&#39;
^^^^^^

SyntaxError: Cannot use import statement outside a module
</code></pre></div><p>Because by default, Node treats <code>js</code> files as Common JS module, so using
<code>import</code> is not supported. We have three ways to let node know that we want to
run our script as an ES module.</p>
<blockquote>
<p>Authors can tell Node.js to use the ECMAScript modules loader via the <code>.mjs</code>
file extension, the <code>package.json</code> <strong>&ldquo;type&rdquo;</strong> field, or the <code>--input-type</code>
flag.</p>
</blockquote>
<p><a href=https://nodejs.org/dist/latest-v18.x/docs/api/esm.html#enabling class=external-link target=_blank rel=noopener>https://nodejs.org/dist/latest-v18.x/docs/api/esm.html#enabling</a>
Without chaning the file name, we can either run this command</p>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>cat price.js | node --input-type=module
</code></pre></div><p>or create <code>package.json</code> file</p>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
    <span style=font-weight:700>&#34;type&#34;</span>: <span style=color:#0ff;font-weight:700>&#34;module&#34;</span>
}
</code></pre></div><p>and then run</p>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ node test.js 
Current price of BTC is 21726.41000000
</code></pre></div><p>But I like the <code>.mjs</code> the most because it the fastest way.</p>
<div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>$ node test.mjs 
Current price of BTC is 21716.93000000
</code></pre></div><p>In this example I also use top level <code>await</code>, so much easier than Python
<code>ev.run_until_complete()</code>.</p>
</div>
<footer>
</footer>
</article>
</section>
</div>
<footer class=footer>
<section class=container>
©
2021 -
2023
Sy Tran
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.
</section>
</footer>
</main>
<script src=/js/coder.min.369d90111ae4409b4e51de5efd23a46b92663fcc82dc9a0efde7f70bffc3f949.js integrity="sha256-Np2QERrkQJtOUd5e/SOka5JmP8yC3JoO/ef3C//D+Uk="></script>
</body>
</html>