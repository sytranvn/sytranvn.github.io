<!doctype html><html lang=en><head><title>Improve ML model performance with GridSearchCV · Sy Tran's blog</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Sy Tran"><meta name=description content="Improving a model with Grid Search Link to heading In this mini-lab, we’ll fit a decision tree model to some sample data. This initial model will overfit heavily. Then we’ll use Grid Search to find better parameters for this model, to reduce the overfitting.
First, some imports.
%matplotlib inline import pandas as pd import numpy as np import matplotlib.pyplot as plt Reading and plotting the data Link to heading Now, a function that will help us read the csv file, and plot the data."><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Improve ML model performance with GridSearchCV"><meta name=twitter:description content="Improving a model with Grid Search Link to heading In this mini-lab, we’ll fit a decision tree model to some sample data. This initial model will overfit heavily. Then we’ll use Grid Search to find better parameters for this model, to reduce the overfitting.
First, some imports.
%matplotlib inline import pandas as pd import numpy as np import matplotlib.pyplot as plt Reading and plotting the data Link to heading Now, a function that will help us read the csv file, and plot the data."><meta property="og:title" content="Improve ML model performance with GridSearchCV"><meta property="og:description" content="Improving a model with Grid Search Link to heading In this mini-lab, we’ll fit a decision tree model to some sample data. This initial model will overfit heavily. Then we’ll use Grid Search to find better parameters for this model, to reduce the overfitting.
First, some imports.
%matplotlib inline import pandas as pd import numpy as np import matplotlib.pyplot as plt Reading and plotting the data Link to heading Now, a function that will help us read the csv file, and plot the data."><meta property="og:type" content="article"><meta property="og:url" content="http://sytranvn.dev/posts/improve-ml-performance-with-grid-search-cv/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-26T00:00:00+00:00"><meta property="article:modified_time" content="2022-06-26T00:00:00+00:00"><link rel=canonical href=http://sytranvn.dev/posts/improve-ml-performance-with-grid-search-cv/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.d9fddbffe6f27e69985dc5fe0471cdb0e57fbf4775714bc3d847accb08f4a1f6.css integrity="sha256-2f3b/+byfmmYXcX+BHHNsOV/v0d1cUvD2Eesywj0ofY=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.002ee2378e14c7a68f1f0a53d9694ed252090987c4e768023fac694a4fc5f793.css integrity="sha256-AC7iN44Ux6aPHwpT2WlO0lIJCYfE52gCP6xpSk/F95M=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/custom.min.9ba8f59f4133a291f09b6452d65fef775606884b5727ea8143758e8d69384a87.css integrity="sha256-m6j1n0EzopHwm2RS1l/vd1YGiEtXJ+qBQ3WOjWk4Soc=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.105.0"></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Sy Tran's blog</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/about/>About</a></li><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=/accomplishments/>Accomplishments</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=http://sytranvn.dev/vi/>🇻🇳</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=http://sytranvn.dev/posts/improve-ml-performance-with-grid-search-cv/>Improve ML model performance with GridSearchCV</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2022-06-26T00:00:00Z>June 26, 2022</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
3-minute read</span></div><div class=categories><i class="fa fa-folder" aria-hidden=true></i>
<a href=/categories/ml/>ML</a></div></div></header><div><h2 id=improving-a-model-with-grid-search>Improving a model with Grid Search
<a class=heading-link href=#improving-a-model-with-grid-search><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>In this mini-lab, we’ll fit a decision tree model to some sample data. This
initial model will overfit heavily. Then we’ll use Grid Search to find better
parameters for this model, to reduce the overfitting.</p><p>First, some imports.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#f92672>%</span>matplotlib inline
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> matplotlib.pyplot <span style=color:#66d9ef>as</span> plt
</span></span></code></pre></div><h2 id=reading-and-plotting-the-data>Reading and plotting the data
<a class=heading-link href=#reading-and-plotting-the-data><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>Now, a function that will help us read the csv file, and plot the data.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>load_pts</span>(csv_name):
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>asarray(pd<span style=color:#f92672>.</span>read_csv(csv_name, header<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>))
</span></span><span style=display:flex><span>    X <span style=color:#f92672>=</span> data[:,<span style=color:#ae81ff>0</span>:<span style=color:#ae81ff>2</span>]
</span></span><span style=display:flex><span>    y <span style=color:#f92672>=</span> data[:,<span style=color:#ae81ff>2</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    plt<span style=color:#f92672>.</span>scatter(X[np<span style=color:#f92672>.</span>argwhere(y<span style=color:#f92672>==</span><span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>flatten(),<span style=color:#ae81ff>0</span>], X[np<span style=color:#f92672>.</span>argwhere(y<span style=color:#f92672>==</span><span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>flatten(),<span style=color:#ae81ff>1</span>],s <span style=color:#f92672>=</span> <span style=color:#ae81ff>50</span>, color <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;blue&#39;</span>, edgecolor <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;k&#39;</span>)
</span></span><span style=display:flex><span>    plt<span style=color:#f92672>.</span>scatter(X[np<span style=color:#f92672>.</span>argwhere(y<span style=color:#f92672>==</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>flatten(),<span style=color:#ae81ff>0</span>], X[np<span style=color:#f92672>.</span>argwhere(y<span style=color:#f92672>==</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>flatten(),<span style=color:#ae81ff>1</span>],s <span style=color:#f92672>=</span> <span style=color:#ae81ff>50</span>, color <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;red&#39;</span>, edgecolor <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;k&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    plt<span style=color:#f92672>.</span>xlim(<span style=color:#f92672>-</span><span style=color:#ae81ff>2.05</span>,<span style=color:#ae81ff>2.05</span>)
</span></span><span style=display:flex><span>    plt<span style=color:#f92672>.</span>ylim(<span style=color:#f92672>-</span><span style=color:#ae81ff>2.05</span>,<span style=color:#ae81ff>2.05</span>)
</span></span><span style=display:flex><span>    plt<span style=color:#f92672>.</span>grid(<span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>    plt<span style=color:#f92672>.</span>tick_params(
</span></span><span style=display:flex><span>        axis<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;x&#39;</span>,
</span></span><span style=display:flex><span>        which<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;both&#39;</span>,
</span></span><span style=display:flex><span>        bottom<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;off&#39;</span>,
</span></span><span style=display:flex><span>        top<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;off&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> X,y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>X, y <span style=color:#f92672>=</span> load_pts(<span style=color:#e6db74>&#39;data.csv&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>show()
</span></span></code></pre></div><p><img src=./output_3_0.png alt=png></p><h2 id=splitting-our-data-into-training-and-testing-sets>Splitting our data into training and testing sets
<a class=heading-link href=#splitting-our-data-into-training-and-testing-sets><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.model_selection <span style=color:#f92672>import</span> train_test_split
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.metrics <span style=color:#f92672>import</span> f1_score, make_scorer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#Fixing a random seed</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> random
</span></span><span style=display:flex><span>random<span style=color:#f92672>.</span>seed(<span style=color:#ae81ff>42</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Split the data into training and testing sets</span>
</span></span><span style=display:flex><span>X_train, X_test, y_train, y_test <span style=color:#f92672>=</span> train_test_split(X, y, test_size<span style=color:#f92672>=</span><span style=color:#ae81ff>0.2</span>, random_state<span style=color:#f92672>=</span><span style=color:#ae81ff>42</span>)
</span></span></code></pre></div><h2 id=fitting-a-decision-tree-model>Fitting a Decision Tree model
<a class=heading-link href=#fitting-a-decision-tree-model><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#f92672>from</span> sklearn.tree <span style=color:#f92672>import</span> DecisionTreeClassifier
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Define the model (with default hyperparameters)</span>
</span></span><span style=display:flex><span>clf <span style=color:#f92672>=</span> DecisionTreeClassifier(random_state<span style=color:#f92672>=</span><span style=color:#ae81ff>42</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Fit the model</span>
</span></span><span style=display:flex><span>clf<span style=color:#f92672>.</span>fit(X_train, y_train)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Make predictions</span>
</span></span><span style=display:flex><span>train_predictions <span style=color:#f92672>=</span> clf<span style=color:#f92672>.</span>predict(X_train)
</span></span><span style=display:flex><span>test_predictions <span style=color:#f92672>=</span> clf<span style=color:#f92672>.</span>predict(X_test)
</span></span></code></pre></div><p>Now let’s plot the model, and find the testing f1_score, to see how we did.
The following function will help us plot the model.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>plot_model</span>(X, y, clf):
</span></span><span style=display:flex><span>    plt<span style=color:#f92672>.</span>scatter(X[np<span style=color:#f92672>.</span>argwhere(y<span style=color:#f92672>==</span><span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>flatten(),<span style=color:#ae81ff>0</span>],X[np<span style=color:#f92672>.</span>argwhere(y<span style=color:#f92672>==</span><span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>flatten(),<span style=color:#ae81ff>1</span>],s <span style=color:#f92672>=</span> <span style=color:#ae81ff>50</span>, color <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;blue&#39;</span>, edgecolor <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;k&#39;</span>)
</span></span><span style=display:flex><span>    plt<span style=color:#f92672>.</span>scatter(X[np<span style=color:#f92672>.</span>argwhere(y<span style=color:#f92672>==</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>flatten(),<span style=color:#ae81ff>0</span>],X[np<span style=color:#f92672>.</span>argwhere(y<span style=color:#f92672>==</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>flatten(),<span style=color:#ae81ff>1</span>],s <span style=color:#f92672>=</span> <span style=color:#ae81ff>50</span>, color <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;red&#39;</span>, edgecolor <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;k&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    plt<span style=color:#f92672>.</span>xlim(<span style=color:#f92672>-</span><span style=color:#ae81ff>2.05</span>,<span style=color:#ae81ff>2.05</span>)
</span></span><span style=display:flex><span>    plt<span style=color:#f92672>.</span>ylim(<span style=color:#f92672>-</span><span style=color:#ae81ff>2.05</span>,<span style=color:#ae81ff>2.05</span>)
</span></span><span style=display:flex><span>    plt<span style=color:#f92672>.</span>grid(<span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>    plt<span style=color:#f92672>.</span>tick_params(
</span></span><span style=display:flex><span>        axis<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;x&#39;</span>,
</span></span><span style=display:flex><span>        which<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;both&#39;</span>,
</span></span><span style=display:flex><span>        bottom<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;off&#39;</span>,
</span></span><span style=display:flex><span>        top<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;off&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    r <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>linspace(<span style=color:#f92672>-</span><span style=color:#ae81ff>2.1</span>,<span style=color:#ae81ff>2.1</span>,<span style=color:#ae81ff>300</span>)
</span></span><span style=display:flex><span>    s,t <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>meshgrid(r,r)
</span></span><span style=display:flex><span>    s <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>reshape(s,(np<span style=color:#f92672>.</span>size(s),<span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>    t <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>reshape(t,(np<span style=color:#f92672>.</span>size(t),<span style=color:#ae81ff>1</span>))
</span></span><span style=display:flex><span>    h <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>concatenate((s,t),<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    z <span style=color:#f92672>=</span> clf<span style=color:#f92672>.</span>predict(h)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    s <span style=color:#f92672>=</span> s<span style=color:#f92672>.</span>reshape((np<span style=color:#f92672>.</span>size(r),np<span style=color:#f92672>.</span>size(r)))
</span></span><span style=display:flex><span>    t <span style=color:#f92672>=</span> t<span style=color:#f92672>.</span>reshape((np<span style=color:#f92672>.</span>size(r),np<span style=color:#f92672>.</span>size(r)))
</span></span><span style=display:flex><span>    z <span style=color:#f92672>=</span> z<span style=color:#f92672>.</span>reshape((np<span style=color:#f92672>.</span>size(r),np<span style=color:#f92672>.</span>size(r)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    plt<span style=color:#f92672>.</span>contourf(s,t,z,colors <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;blue&#39;</span>,<span style=color:#e6db74>&#39;red&#39;</span>],alpha <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.2</span>,levels <span style=color:#f92672>=</span> range(<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>2</span>))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(np<span style=color:#f92672>.</span>unique(z)) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>        plt<span style=color:#f92672>.</span>contour(s,t,z,colors <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;k&#39;</span>, linewidths <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>    plt<span style=color:#f92672>.</span>show()
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=display:flex><span>plot_model(X, y, clf)
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;The Training F1 Score is&#39;</span>, f1_score(train_predictions, y_train))
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#39;The Testing F1 Score is&#39;</span>, f1_score(test_predictions, y_test))
</span></span></code></pre></div><p><img src=./output_11_0.png alt></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>The Training F1 Score is 1.0
</span></span><span style=display:flex><span>The Testing F1 Score is 0.7000000000000001
</span></span></code></pre></div><p>Woah! Some heavy overfitting there. Not just from looking at the graph, but also from looking at the difference between the high training score (1.0) and the low testing score (0.7).Let’s see if we can find better hyperparameters for this model to do better. We’ll use grid search for this.</p><h2 id=use-grid-search-to-improve-this-model>Use grid search to improve this model.
<a class=heading-link href=#use-grid-search-to-improve-this-model><i class="fa fa-link" aria-hidden=true title="Link to heading"></i>
<span class=sr-only>Link to heading</span></a></h2><p>In here, we’ll do the following steps:</p><p>First define some parameters to perform grid search on. We suggest to play with max_depth, min_samples_leaf, and min_samples_split.
Make a scorer for the model using f1_score.
Perform grid search on the classifier, using the parameters and the scorer.
Fit the data to the new classifier.
Plot the model and find the f1_score.
If the model is not much better, try changing the ranges for the parameters and fit it again.</p></div><footer><div class=comments><script>let getTheme=window.localStorage&&window.localStorage.getItem("colorscheme");getTheme=getTheme??"preferred-color-scheme";let theme=getTheme==="dark"?"github-dark":"github-light",s=document.createElement("script");s.src="https://utteranc.es/client.js",s.setAttribute("repo","sytranvn/sytranvn.lounge"),s.setAttribute("issue-term","title"),s.setAttribute("theme",theme),s.setAttribute("crossorigin","anonymous"),s.setAttribute("async",""),document.querySelector("div.comments").innerHTML="",document.querySelector("div.comments").appendChild(s)</script></div></footer></article></section></div><footer class=footer><section class=container>©
2022
Sy Tran
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer><script data-name=BMC-Widget data-cfasync=false src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=sytranvn data-description="Support me on Buy me a coffee!" data-message="Thank you for visiting ❤️ . You can now buy me a conffe." data-color=#ff813f data-position=Right data-x_margin=18 data-y_margin=18></script></main><script src=/js/coder.min.236049395dc3682fb2719640872958e12f1f24067bb09c327b233e6290c7edac.js integrity="sha256-I2BJOV3DaC+ycZZAhylY4S8fJAZ7sJwyeyM+YpDH7aw="></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FHPRSC6XDQ"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-FHPRSC6XDQ",{anonymize_ip:!1})}</script></body></html>