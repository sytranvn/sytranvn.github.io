<!doctype html><html lang=en><head><title>Nodejs Primordials ¬∑ sytranvn.dev</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Sy Tran"><meta name=description content="I was reading the NodeJS http library and a variable named 'primordials' caught
my attention. For many years working with NodeJS, I haven't seen this variable
once. And it was used under 'use strict' flag.
"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Nodejs Primordials"><meta name=twitter:description content="I was reading the NodeJS http library and a variable named 'primordials' caught
my attention. For many years working with NodeJS, I haven't seen this variable
once. And it was used under 'use strict' flag."><meta property="og:url" content="https://sytranvn.dev/posts/nodejs-primordials/"><meta property="og:site_name" content="sytranvn.dev"><meta property="og:title" content="Nodejs Primordials"><meta property="og:description" content="I was reading the NodeJS http library and a variable named 'primordials' caught
my attention. For many years working with NodeJS, I haven't seen this variable
once. And it was used under 'use strict' flag."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-08-14T17:37:48+07:00"><meta property="article:modified_time" content="2025-08-14T17:37:48+07:00"><meta property="article:tag" content="Nodejs"><meta property="article:tag" content="Hijacking"><link rel=canonical href=https://sytranvn.dev/posts/nodejs-primordials/><link rel=preload href=/fonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=/fonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.6445a802b9389c9660e1b07b724dcf5718b1065ed2d71b4eeaf981cc7cc5fc46.css integrity="sha256-ZEWoArk4nJZg4bB7ck3PVxixBl7S1xtO6vmBzHzF/EY=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/custom.min.14b400827539da755b0d46f2e69147089c47acc5e169eaa464caf99e0bc9fd38.css integrity="sha256-FLQAgnU52nVbDUby5pFHCJxHrMXhaeqkZMr5ngvJ/Tg=" crossorigin=anonymous media=screen><link rel=icon type=image/svg+xml href=/images/favicon.svg sizes=any><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5></head><body class="preload-transitions colorscheme-auto"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa-solid fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://sytranvn.dev/>sytranvn.dev
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa-solid fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/now/>Now</a></li><li class=navigation-item><a class=navigation-link href=/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=/projects/>Projects</a></li><li class=navigation-item><a class=navigation-link href=/i-heart-oss/>I ‚ù§Ô∏è OSS</a></li><li class=navigation-item><a class=navigation-link href=/accomplishments/>Accomplishments</a></li><li class=navigation-item><a class=navigation-link href=/resume.pdf>Resume</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=/vi/>üáªüá≥</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://sytranvn.dev/posts/nodejs-primordials/>Nodejs Primordials</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa-solid fa-calendar" aria-hidden=true></i>
<time datetime=2025-08-14T17:37:48+07:00>August 14, 2025
</time></span><span class=reading-time><i class="fa-solid fa-clock" aria-hidden=true></i>
4-minute read</span></div><div class=categories><i class="fa-solid fa-folder" aria-hidden=true></i>
<a href=/categories/nodejs/>Nodejs</a></div><div class=tags><i class="fa-solid fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/nodejs/>Nodejs</a>
</span><span class=separator>‚Ä¢</span>
<span class=tag><a href=/tags/hijacking/>Hijacking</a></span></div></div><script id=diffblog-plugin-script async src=https://diff.blog/static/js/diffblog_plugin_v1.js></script><script>document.getElementById("diffblog-plugin-script").addEventListener("load",function(){DiffBlog("4at5qx7n0j5yhd86rqu6gyotkgn4o17hu8wn6xis54lwd692ez")})</script></header><div class=post-content>I was reading the NodeJS http library and a variable named 'primordials' caught
my attention. For many years working with NodeJS, I haven't seen this variable
once. And it was used under 'use strict' flag.<p>This is a part of <code>_http_server.js</code> file from NodeJS source.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// node/lib/_http_server.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=s1>&#39;use strict&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>ArrayIsArray</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nb>Error</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>MathMin</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>ObjectKeys</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>ObjectSetPrototypeOf</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>ReflectApply</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>Symbol</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>SymbolAsyncDispose</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>SymbolFor</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=o>=</span> <span class=nx>primordials</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>net</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;net&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>EE</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;events&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>assert</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;internal/assert&#39;</span><span class=p>);</span>
</span></span></code></pre></div><p>I was panic. How did I miss this global variable for so many years working with
NodeJS? It contains Javascripts builtin classes like <code>Error</code>, <code>Symbol</code>, &mldr; And
under <code>'use strict'</code> flag, it must be some thing legal to use, right?</p><p>I immediately open up the <code>node</code> repl to check what it is. But the result was a disappointment.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$ node
</span></span><span class=line><span class=cl>Welcome to Node.js v22.5.1.
</span></span><span class=line><span class=cl>Type &#34;.help&#34; for more information.
</span></span><span class=line><span class=cl>&gt; primordials
</span></span><span class=line><span class=cl>Uncaught ReferenceError: primordials is not defined
</span></span><span class=line><span class=cl>&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback></code></pre></div><p>MDN doesn&rsquo;t have any documents about <code>primordials</code> as well. So it must be some
hijacking variable created by NodeJS developers. Luckily someone found it and
posted <a href=https://stackoverflow.com/questions/59750976/what-are-primordials-in-node-js class=external-link target=_blank rel=noopener>a question on
stackoverflow</a>
before. So I follow the link, on the <a href=https://github.com/nodejs/node/blob/main/lib/internal/per_context/primordials.js class=external-link target=_blank rel=noopener>main
branch</a>.</p><p>As stated in source code document.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// This file subclasses and stores the JS builtins that come from the VM
</span></span></span><span class=line><span class=cl><span class=c1>// so that Node.js&#39;s builtin modules do not need to later look these up from
</span></span></span><span class=line><span class=cl><span class=c1>// the global proxy, which can be mutated by users.
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback></code></pre></div><p>So the intention is clear, this helps NodeJS developers quickly access builtins,
and worry about them being mutated by users.</p><p>This is the full source code at commit <a href=https://github.com/nodejs/node/blob/141a6e34eed05577edf43ad085a74f330d0559cb/lib/internal/per_context/primordials.js class=external-link target=_blank rel=noopener>141a6e3</a> in 2019.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=s1>&#39;use strict&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/* eslint-disable no-restricted-globals */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// This file subclasses and stores the JS builtins that come from the VM
</span></span></span><span class=line><span class=cl><span class=c1>// so that Node.js&#39;s builtin modules do not need to later look these up from
</span></span></span><span class=line><span class=cl><span class=c1>// the global proxy, which can be mutated by users.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// TODO(joyeecheung): we can restrict access to these globals in builtin
</span></span></span><span class=line><span class=cl><span class=c1>// modules through the JS linter, for example: ban access such as `Object`
</span></span></span><span class=line><span class=cl><span class=c1>// (which falls back to a lookup in the global proxy) in favor of
</span></span></span><span class=line><span class=cl><span class=c1>// `primordials.Object` where `primordials` is a lexical variable passed
</span></span></span><span class=line><span class=cl><span class=c1>// by the native module compiler.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>ReflectApply</span> <span class=o>=</span> <span class=nx>Reflect</span><span class=p>.</span><span class=nx>apply</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// This function is borrowed from the function with the same name on V8 Extras&#39;
</span></span></span><span class=line><span class=cl><span class=c1>// `utils` object. V8 implements Reflect.apply very efficiently in conjunction
</span></span></span><span class=line><span class=cl><span class=c1>// with the spread syntax, such that no additional special case is needed for
</span></span></span><span class=line><span class=cl><span class=c1>// function calls w/o arguments.
</span></span></span><span class=line><span class=cl><span class=c1>// Refs: https://github.com/v8/v8/blob/d6ead37d265d7215cf9c5f768f279e21bd170212/src/js/prologue.js#L152-L156
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span> <span class=nx>uncurryThis</span><span class=p>(</span><span class=nx>func</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span><span class=nx>thisArg</span><span class=p>,</span> <span class=p>...</span><span class=nx>args</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>ReflectApply</span><span class=p>(</span><span class=nx>func</span><span class=p>,</span> <span class=nx>thisArg</span><span class=p>,</span> <span class=nx>args</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>primordials</span><span class=p>.</span><span class=nx>uncurryThis</span> <span class=o>=</span> <span class=nx>uncurryThis</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>copyProps</span><span class=p>(</span><span class=nx>src</span><span class=p>,</span> <span class=nx>dest</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>key</span> <span class=k>of</span> <span class=nx>Reflect</span><span class=p>.</span><span class=nx>ownKeys</span><span class=p>(</span><span class=nx>src</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>Reflect</span><span class=p>.</span><span class=nx>getOwnPropertyDescriptor</span><span class=p>(</span><span class=nx>dest</span><span class=p>,</span> <span class=nx>key</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Reflect</span><span class=p>.</span><span class=nx>defineProperty</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>dest</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>Reflect</span><span class=p>.</span><span class=nx>getOwnPropertyDescriptor</span><span class=p>(</span><span class=nx>src</span><span class=p>,</span> <span class=nx>key</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>copyPropsRenamed</span><span class=p>(</span><span class=nx>src</span><span class=p>,</span> <span class=nx>dest</span><span class=p>,</span> <span class=nx>prefix</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>key</span> <span class=k>of</span> <span class=nx>Reflect</span><span class=p>.</span><span class=nx>ownKeys</span><span class=p>(</span><span class=nx>src</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>key</span> <span class=o>===</span> <span class=s1>&#39;string&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>Reflect</span><span class=p>.</span><span class=nx>defineProperty</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>dest</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sb>`</span><span class=si>${</span><span class=nx>prefix</span><span class=si>}${</span><span class=nx>key</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>toUpperCase</span><span class=p>()</span><span class=si>}${</span><span class=nx>key</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>Reflect</span><span class=p>.</span><span class=nx>getOwnPropertyDescriptor</span><span class=p>(</span><span class=nx>src</span><span class=p>,</span> <span class=nx>key</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>copyPrototype</span><span class=p>(</span><span class=nx>src</span><span class=p>,</span> <span class=nx>dest</span><span class=p>,</span> <span class=nx>prefix</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>for</span> <span class=p>(</span><span class=kr>const</span> <span class=nx>key</span> <span class=k>of</span> <span class=nx>Reflect</span><span class=p>.</span><span class=nx>ownKeys</span><span class=p>(</span><span class=nx>src</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>key</span> <span class=o>===</span> <span class=s1>&#39;string&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=kr>const</span> <span class=nx>desc</span> <span class=o>=</span> <span class=nx>Reflect</span><span class=p>.</span><span class=nx>getOwnPropertyDescriptor</span><span class=p>(</span><span class=nx>src</span><span class=p>,</span> <span class=nx>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=k>typeof</span> <span class=nx>desc</span><span class=p>.</span><span class=nx>value</span> <span class=o>===</span> <span class=s1>&#39;function&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>desc</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>uncurryThis</span><span class=p>(</span><span class=nx>desc</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nx>Reflect</span><span class=p>.</span><span class=nx>defineProperty</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>dest</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=sb>`</span><span class=si>${</span><span class=nx>prefix</span><span class=si>}${</span><span class=nx>key</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>toUpperCase</span><span class=p>()</span><span class=si>}${</span><span class=nx>key</span><span class=p>.</span><span class=nx>slice</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=si>}</span><span class=sb>`</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>desc</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>makeSafe</span><span class=p>(</span><span class=nx>unsafe</span><span class=p>,</span> <span class=nx>safe</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>copyProps</span><span class=p>(</span><span class=nx>unsafe</span><span class=p>.</span><span class=nx>prototype</span><span class=p>,</span> <span class=nx>safe</span><span class=p>.</span><span class=nx>prototype</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>copyProps</span><span class=p>(</span><span class=nx>unsafe</span><span class=p>,</span> <span class=nx>safe</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nb>Object</span><span class=p>.</span><span class=nx>setPrototypeOf</span><span class=p>(</span><span class=nx>safe</span><span class=p>.</span><span class=nx>prototype</span><span class=p>,</span> <span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nb>Object</span><span class=p>.</span><span class=nx>freeze</span><span class=p>(</span><span class=nx>safe</span><span class=p>.</span><span class=nx>prototype</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nb>Object</span><span class=p>.</span><span class=nx>freeze</span><span class=p>(</span><span class=nx>safe</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>safe</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Subclass the constructors because we need to use their prototype
</span></span></span><span class=line><span class=cl><span class=c1>// methods later.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>primordials</span><span class=p>.</span><span class=nx>SafeMap</span> <span class=o>=</span> <span class=nx>makeSafe</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>Map</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=kr>class</span> <span class=nx>SafeMap</span> <span class=kr>extends</span> <span class=nx>Map</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>primordials</span><span class=p>.</span><span class=nx>SafeWeakMap</span> <span class=o>=</span> <span class=nx>makeSafe</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>WeakMap</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=kr>class</span> <span class=nx>SafeWeakMap</span> <span class=kr>extends</span> <span class=nx>WeakMap</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>primordials</span><span class=p>.</span><span class=nx>SafeSet</span> <span class=o>=</span> <span class=nx>makeSafe</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nx>Set</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=kr>class</span> <span class=nx>SafeSet</span> <span class=kr>extends</span> <span class=nx>Set</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>primordials</span><span class=p>.</span><span class=nx>SafePromise</span> <span class=o>=</span> <span class=nx>makeSafe</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=nb>Promise</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=kr>class</span> <span class=nx>SafePromise</span> <span class=kr>extends</span> <span class=nb>Promise</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create copies of the namespace objects
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;JSON&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;Math&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;Reflect&#39;</span>
</span></span><span class=line><span class=cl><span class=p>].</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>name</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>copyPropsRenamed</span><span class=p>(</span><span class=nx>global</span><span class=p>[</span><span class=nx>name</span><span class=p>],</span> <span class=nx>primordials</span><span class=p>,</span> <span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Create copies of intrinsic objects
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;Array&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;ArrayBuffer&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;BigInt&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;Boolean&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;Date&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;Error&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;Function&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;Map&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;Number&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;Object&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;RegExp&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;Set&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;String&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;Symbol&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;WeakMap&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=s1>&#39;WeakSet&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>].</span><span class=nx>forEach</span><span class=p>((</span><span class=nx>name</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>original</span> <span class=o>=</span> <span class=nx>global</span><span class=p>[</span><span class=nx>name</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=nx>primordials</span><span class=p>[</span><span class=nx>name</span><span class=p>]</span> <span class=o>=</span> <span class=nx>original</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>copyPropsRenamed</span><span class=p>(</span><span class=nx>original</span><span class=p>,</span> <span class=nx>primordials</span><span class=p>,</span> <span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>copyPrototype</span><span class=p>(</span><span class=nx>original</span><span class=p>.</span><span class=nx>prototype</span><span class=p>,</span> <span class=nx>primordials</span><span class=p>,</span> <span class=sb>`</span><span class=si>${</span><span class=nx>name</span><span class=si>}</span><span class=sb>Prototype`</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Object</span><span class=p>.</span><span class=nx>setPrototypeOf</span><span class=p>(</span><span class=nx>primordials</span><span class=p>,</span> <span class=kc>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nb>Object</span><span class=p>.</span><span class=nx>freeze</span><span class=p>(</span><span class=nx>primordials</span><span class=p>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback></code></pre></div><p>In 2025, the file is about 700 lines of code compare to 128 LOC in 2019. After,
6 years, the amount of features added to Javascripts is massive.</p><p>Now we know what <code>primordials</code> is and why it was created. The remaining question is
can we access it from <code>node</code>, if so, how?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>node --expose-internals 
</span></span><span class=line><span class=cl>Welcome to Node.js v22.5.1.
</span></span><span class=line><span class=cl>Type &#34;.help&#34; for more information.
</span></span><span class=line><span class=cl>&gt; primodials
</span></span><span class=line><span class=cl>Uncaught ReferenceError: primodials is not defined
</span></span><span class=line><span class=cl>&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback></code></pre></div><p>Enabling <code>expose-internals</code> flag doesn&rsquo;t help us. I will continue this when I find a way.</p></div><footer><section class=see-also></section></footer></article></section></div><footer class=footer><section class=container>¬©
2021 -
2025
Sy Tran
¬∑
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script></body></html>