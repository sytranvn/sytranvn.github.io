<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Lldb on sytranvn.dev</title><link>https://sytranvn.dev/categories/lldb/</link><description>Recent content in Lldb on sytranvn.dev</description><generator>Hugo</generator><language>en</language><lastBuildDate>Thu, 10 Feb 2022 00:00:00 +0000</lastBuildDate><atom:link href="https://sytranvn.dev/categories/lldb/index.xml" rel="self" type="application/rss+xml"/><item><title>Debug V8 part 2</title><link>https://sytranvn.dev/posts/debug-v8-part-2/</link><pubDate>Thu, 10 Feb 2022 00:00:00 +0000</pubDate><guid>https://sytranvn.dev/posts/debug-v8-part-2/</guid><description>&lt;p&gt;In previous part, we have learnt how to debug &lt;code&gt;d8&lt;/code&gt; with &lt;code&gt;lldb&lt;/code&gt;. In this part
we still use our &lt;code&gt;debug.js&lt;/code&gt; script. But we&amp;rsquo;ll add an other parameter to &lt;code&gt;d8&lt;/code&gt;
before running process.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;lldb -- d8 --parse-only debug.js
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;With &lt;code&gt;parse-only&lt;/code&gt; flag, we will forcus on how &lt;code&gt;d8&lt;/code&gt; parse source content and
turn into lexical input elements.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s add a breakpoint in &lt;code&gt;v8::Shell::RunMain&lt;/code&gt; function and jump to it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-shell" data-lang="shell"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;(&lt;/span&gt;lldb&lt;span class="o"&gt;)&lt;/span&gt; b v8::Shell::RunMain
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;(&lt;/span&gt;lldb&lt;span class="o"&gt;)&lt;/span&gt; run
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;frame &lt;span class="c1"&gt;#0: 0x000000010004ba68 d8`v8::Shell::RunMain(isolate=0x0000000118110000, last_run=true) at d8.cc:4578:12&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; 4575	&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="m"&gt;4576&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; 4577	int Shell::RunMain&lt;span class="o"&gt;(&lt;/span&gt;Isolate* isolate, bool last_run&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line hl"&gt;&lt;span class="cl"&gt;-&amp;gt; 4578	 &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;int &lt;span class="nv"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; 1&lt;span class="p"&gt;;&lt;/span&gt; i &amp;lt; options.num_isolates&lt;span class="p"&gt;;&lt;/span&gt; ++i&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; 4579	 options.isolate_sources&lt;span class="o"&gt;[&lt;/span&gt;i&lt;span class="o"&gt;]&lt;/span&gt;.StartExecuteInThread&lt;span class="o"&gt;()&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; 4580	 &lt;span class="o"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; 4581	 bool &lt;span class="nv"&gt;success&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; true&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;At line 4578, we will loop through different isolate sources and execute them
in threads. But as our &lt;code&gt;options.num_isolates = 1&lt;/code&gt;, we don&amp;rsquo;t need to worry about
multi-threads at this point.&lt;/p&gt;</description></item><item><title>Debug V8 part 1</title><link>https://sytranvn.dev/posts/debug-v8-part-1/</link><pubDate>Sun, 06 Feb 2022 00:00:00 +0000</pubDate><guid>https://sytranvn.dev/posts/debug-v8-part-1/</guid><description>&lt;h2 id="3-things-to-do-before-debugging-v8"&gt;
 3 things to do before debugging V8
 &lt;a class="heading-link" href="#3-things-to-do-before-debugging-v8"&gt;
 &lt;i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"&gt;&lt;/i&gt;
 &lt;span class="sr-only"&gt;Link to heading&lt;/span&gt;
 &lt;/a&gt;
&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href="#build-d8-with-debug-flags-from-v8-source" &gt;Build d8 with debug flags from V8 source&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#install-lldb" &gt;Install lldb&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#create-a-js-file" &gt;A javascript file&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="build-d8-with-debug-flags-from-v8-source"&gt;
 Build d8 with debug flags from V8 source
 &lt;a class="heading-link" href="#build-d8-with-debug-flags-from-v8-source"&gt;
 &lt;i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"&gt;&lt;/i&gt;
 &lt;span class="sr-only"&gt;Link to heading&lt;/span&gt;
 &lt;/a&gt;
&lt;/h3&gt;
&lt;p&gt;If you haven&amp;rsquo;t tried building V8 before, take a look at my other blog on how to
build V8 from source on &lt;a href="https://sytranvn.dev/posts/build-v8-from-source/" &gt;Ubuntu&lt;/a&gt; and
&lt;a href="https://sytranvn.dev/posts/build-v8-from-source-on-apple-m1/" &gt;Mac M1&lt;/a&gt;. Now we just need to make sure the d8
binary is built with &lt;code&gt;debug&lt;/code&gt; flag instead of &lt;code&gt;release&lt;/code&gt;.
You can run this command &lt;code&gt;gm.py arm64.debug.d8&lt;/code&gt;. Or incase you have built a
release version and don&amp;rsquo;t want to rebuild everything. Open
&lt;code&gt;out/release/args.gn&lt;/code&gt; file and update following options.&lt;/p&gt;</description></item></channel></rss>